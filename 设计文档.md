# ⾏情中⼼系统

# 1 系统介绍与展示

⾏情中⼼系统，支持股票买卖⾏情信息导⼊、用户在线行情查询、股票订阅与行情可视化。


![avatar](./pic/系统框架图.png)

系统架构图

# 2 系统描述

## 2.1 系统功能

### 2.1.1 用户登陆注册鉴权：

| 功能点            | 详细描述                                                |
|:---------------|:----------------------------------------------------|
| **注册账号**       | 未注册用户注册成为产品用户，从而具备享有产品各项服务的资格                       |
| **登录账号**       | 用户登录产品，获得产品提供的各项服务                                  |
| **修改密码**       | 用户忘记密码支持修改密码                                  |


### 2.1.2 股票行情导入

支持手动导入、也可以支持生效以后的自动导入。自动导入这里有一个开关，用户可以去控制这个自动执行的开关。


### 2.1.3 前端股票五档数据可视化


### 2.1.4 股票行情查询


### 2.1.5 行情可监控
支持用户订阅相关股票，并基于行情变化主动推送钉钉消息


### 2.1.6 行情存储对象抽象统一


| **订阅股票**   | 注册的用户可以获得选择股票进行订阅             |
| **行情信息导入**     | 系统每天固定时间点从接口获得交易所股票买卖⾏情，并更新到数据库                           |
| **股票行情可视化**   | 支持将股票出5档⾏情走势按照图表形式绘制出来         |
| **更新股票热榜**     | 该功能在用户访问产品时触发，根据一定规则，计算股票的热度，对股票热榜进行更新｜             |
| **股票行情监控**     | 监控用户订阅的股票产品，并根据一定规则，基于⾏情变化对用户做出相应的提醒｜             |
| **⾏情信息⼴播推送**     | 将用户订阅的股票信息推送到系统首页，并按需发短信提醒 ｜             |


## 2.2 模型设计

![avatar](./pic/ER.png)

### 2.1 用户模块
```sql

CREATE TABLE `user` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `password` varchar(50) NOT NULL,
  `name` varchar(50) NOT NULL NOT NULL DEFAULT '',
  `mobile` varchar(50) NOT NULL DEFAULT '',
  `email` varchar(50) NOT NULL DEFAULT '',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`)
) ENGINE=InnoDB;

```
### 2.2 行情导入模块

股票基本信息

```sql

CREATE TABLE `stock_info` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(6) NOT NULL,
  `name` varchar(50) NOT NULL,
  `exchange` varchar(2) NOT NULL,
  `abbreviation` varchar(50) NOT NULL,
  `state` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `type` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `description` varchar(100) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_exchange_code` (`exchange`,`code`)
) ENGINE=InnoDB;

```

股票行情信息

```sql

CREATE TABLE `daily_index` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(50) NOT NULL,
  `date` date NOT NULL,
  `pre_closing_price` decimal(20, 2) NOT NULL,
  `opening_price` decimal(20, 2) NOT NULL,
  `highest_price` decimal(20, 2) NOT NULL,
  `lowest_price` decimal(20, 2) NOT NULL,
  `closing_price` decimal(20, 2) NOT NULL,
  `trading_volume` bigint NOT NULL,
  `trading_value` decimal(20, 2) NOT NULL,
  `rurnover_rate` decimal(20, 2) NOT NULL,
  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `ik_code` (`code`)
) ENGINE=InnoDB;

```

数据源管理
```sql

CREATE TABLE `system_config` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `value1` varchar(100) NOT NULL,
  `value2` varchar(100) NOT NULL DEFAULT '',
  `value3` varchar(100) NOT NULL DEFAULT '',
  `state` tinyint(4) unsigned NOT NULL DEFAULT '1',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

```

### 2.2 定时任务模块

```sql

CREATE TABLE `task` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `state` tinyint(4) unsigned NOT NULL,
  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `description` varchar(100) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB;

```

### 2.3 股票订阅与监控模块

用户订阅的股票：

```sql

CREATE TABLE `stock_selected` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(50) NOT NULL UNIQUE,
  `name` varchar(50) NOT NULL UNIQUE,
  `rate` decimal(20, 6) NOT NULL DEFAULT '0.02',
  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `description` varchar(100) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

```

监控并发送钉钉消息：

```sql

CREATE TABLE `robot` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `type` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `webhook` varchar(200) NOT NULL DEFAULT '',
  `state` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `description` varchar(100) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

```

## 2.3 接口设计

### 请求值和返回值


## 2.4 代码分层设计



# 3. 具体需求

## 3.1 外部接口需求

### 3.1.1 用户界面

1. 注册登陆界面
2. 首页
3. 股票行情信息展示界面
5. 个人中心

### 3.1.2 软件接口

- MacOS 操作系统；
- Aapche Kafka；
- etcd v3.4.15；
- Nginx 1.19.8。

### 3.1.3 通信接口

HTTPS协议、TCP/IP协议。

## 3.2 功能需求

### 3.2.1 web模块

#### 3.2.1.1 注册账号、修改密码
| **用例名**             | **注册账号**                                                                                                                        |
|---------------------|---------------------------------------------------------------------------------------------------------------------------------|
| **基本事件流**           | (1) 用户打开注册页面 <br>(2) 用户填写密码，用户名等身份信息(A-1)(A-2) <br>(3) 用户点击注册按钮 <br>(4) 系统验证该用户信息是否符合规范 <br>(5) 系统验证该用户名是否被注册过 <br>(6) 系统返回注册结果 |
| **备选事件流**           | A-1 用户信息不符合规范<br>(1) 系统提示信息不符合规范 <br>  (2) 用户重新输入 <br>A-2 用户被注册过<br>  (1) 系统提示用户用户名重复 <br>  (2) 用户重新输入                          |
| **补充约束<br>- 数据约束**  | (1) 密码不能为空 <br>(2) 电话不能为空                                                                                                       |
| **补充约束<br>- 非功能需求** | 系统响应时间不超过15秒                                                                                                                    |


#### 3.2.1.2 登录账号

| **用例名**             | **登录账号**                                                                                                                                                                                                 |
|---------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **基本事件流**           | (1) 用例起始于未登录用户想要登录系统 <br>(2) 未登录用户点击【登录】按钮，系统跳转到登录页面(A-1) <br>(3) 用户在登录页面填入相关信息(D-1)，点击【登录】(A-2)(A-3)(A-4)                                                                                               |
| **备选事件流**           | A-1 系统繁忙或网络出现问题<br>(1) 系统提示：系统繁忙，请稍后再试<br>A-2 用户的账户未注册 <br>(1) 系统提示：该账户不存在，请注册后再使用<br>(2) 系统跳转到注册页面<br>A-3 用户登录成功 <br> (1) 系统提示：登录成功 <br>  (2) 系统跳转到主页或用户之前浏览的页面<br>A-4 用户登录失败<br>(1) 系统提示：登录信息不正确，请重新输入 |
| **补充约束<br>- 数据约束**  | D-1 提交的数据需要包含账户名，密码                                                                                                                                                                                      |
| **补充约束<br>- 非功能需求** | 无                                                                                                                                                                                                        |

#### 3.2.1.3 订阅股票
| **用例名**             | **订阅股票**                             |
|---------------------|--------------------------------------|
| **基本事件流**           | (1) 点击订阅，输入股票编号 <br>(2) 系统提示订阅成功并修改数据库(A-1) |
| **备选事件流**           | A-1 系统繁忙或网络出现问题<br>系统提示：系统繁忙，请稍后再试   |
| **补充约束<br>- 数据需求**  | 提交数据包括用户字段和股票编号                   |
| **补充约束<br>- 非功能需求** | 暂无                                   |


#### 3.2.1.4 行情信息导入
| **用例名**         | 行情信息导入                                |
|-----------------|--------------------------------------------------------------------------|
| **基本事件流**       | 系统固定时间自发从接口获得交易所股票买卖行情信息，并针对信息进行相关的数据计算、处理等  |
| **备选事件流**       | 暂无   |
| **补充约束- 数据需求**  | 暂无              |
| **补充约束- 非功能需求** | 暂无             |


#### 3.2.1.5 更新股票热榜
| **用例名**         | 更新股票热榜                      |
|-----------------|--------------------------------------------------------------------------|
| **基本事件流**       | 用户访问产品时触发，现实当前股票热度从上往下前10个股票的具体行情信息  |
| **备选事件流**       | 暂无   |
| **补充约束- 数据需求**  | 暂无              |
| **补充约束- 非功能需求** | 暂无             |


#### 3.2.1.6 股票行情监控


| **用例名**             | **股票行情监控**           |
|---------------------|---------------------------------------------------------------------------------------------------------------------------------|
| **基本事件流**           | (1) 用户打开首页面 <br>(2) 系统显示该用户订阅过的股票行情数据 |
| **备选事件流**           | A-1 用户未订阅股票<br>(1) 系统提示您未订阅股票 <br>   |
| **补充约束<br>- 数据约束**  | (1) 暂无                            |
| **补充约束<br>- 非功能需求** | 系统响应时间不超过15秒 |


#### 3.2.1.7 行情信息广播推送


| **用例名**             | **行情信息广播推送**           |
|---------------------|---------------------------------------------------------------------------------------------------------------------------------|
| **基本事件流**           | (1) 用户打开首页面 <br>(2) 系统监控用户选择的股票，判断换手率是否变化（3）若变化，则系统发送钉钉群提醒。 |
| **备选事件流**           | A-1 用户未订阅股票<br>(1) 无任何消息 <br>   |
| **补充约束<br>- 数据约束**  | 暂无                            |
| **补充约束<br>- 非功能需求** |暂无|
                                      
# 4. ⾼性能低时延的理解与设计


# 5. 未来方向

